<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ["$", "$"],
          ["\\(", "\\)"],
        ],
      },
      svg: {
        fontCache: "global",
      },
    };
  </script>
  <script
    type="text/javascript"
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
  ></script>
  <head>
    <title>Proj 5</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Project 5 - Fun With Diffusion Models!</h1>

    <h2>Part A - The Power of Diffusion Models!</h2>

    <h3>By Ethan Chen</h3>

    <h2>Introduction</h2>

    <p>This project aims to implement and deploy diffusion models to generate images.</p>

    <h2>Part 1: Sampling Loops</h2>

    <h3>Part 1.1: Implementing the Forward Process</h3>

    <p>
      We start by implementing the forward function to add noise to a clean image, which follows the
      equation below.
    </p>

    <!-- prettier-ignore -->
    <div class="large-mathjax">
        $
        x_t = \sqrt{\bar{\alpha}_t}x_0 + \sqrt{1-\bar{\alpha}_t\epsilon} \text{ where } \epsilon \sim N(0,1)
        $
    </div>

    <br />

    <div class="image-container-4">
      <div class="image-item">
        <h4 class="image-title">Berkeley Campanile</h4>
        <div class="image-wrapper">
          <img src="media/part_a/campanile_modified.jpg" alt="campanile_modified.jpg" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_250.png" alt="noisy_campanile_t_250.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_500.png" alt="noisy_campanile_t_500.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_750.png" alt="noisy_campanile_t_750.png" />
        </div>
      </div>
    </div>

    <h3>Part 1.2: Classical Denoising</h3>

    <p>
      Now, we can use Gaussian blur filtering to attempt to remove the noise. As we can see, this
      method does not really work since we cannot clearly distinguish the campanile in the image.
    </p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/noisy_and_blurred_campanile_t_250.png"
            alt="noisy_and_blurred_campanile_t_250.png"
          />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/noisy_and_blurred_campanile_t_500.png"
            alt="noisy_and_blurred_campanile_t_500.png"
          />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/noisy_and_blurred_campanile_t_750.png"
            alt="noisy_and_blurred_campanile_t_750.png"
          />
        </div>
      </div>
    </div>

    <h3>Part 1.3: One-Step Denoising</h3>

    <p></p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/noisy_and_denoised_campanile_t_250.png"
            alt="noisy_and_denoised_campanile_t_250.png"
          />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/noisy_and_denoised_campanile_t_500.png"
            alt="noisy_and_denoised_campanile_t_500.png"
          />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/noisy_and_denoised_campanile_t_750.png"
            alt="noisy_and_denoised_campanile_t_750.png"
          />
        </div>
      </div>
    </div>

    <h3>Part 1.4: Iterative Denoising</h3>

    <p></p>

    <div class="image-container-5">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_690.png" alt="noisy_campanile_t_690.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_540.png" alt="noisy_campanile_t_540.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_390.png" alt="noisy_campanile_t_390.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_240.png" alt="noisy_campanile_t_240.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/noisy_campanile_t_90.png" alt="noisy_campanile_t_90.png" />
        </div>
      </div>
    </div>

    <div class="image-container-4">
      <div class="image-item">
        <h4 class="image-title">Berkeley Campanile</h4>
        <div class="image-wrapper">
          <img src="media/part_a/campanile_modified.jpg" alt="campanile_modified.jpg" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/iterative_denoised_campanile.png"
            alt="iterative_denoised_campanile.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/one_step_denoised_campanile.png"
            alt="one_step_denoised_campanile.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/gaussian_blurred_campanile.png"
            alt="gaussian_blurred_campanile.png"
          />
        </div>
      </div>
    </div>

    <h3>Part 1.5: Diffusion Model Sampling</h3>

    <p></p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/5_sampled_images_part1.5.png" alt="5_sampled_images_part1.5.png" />
        </div>
      </div>
    </div>

    <h3>Part 1.6: Classifier-Free Guidance (CFG)</h3>

    <p></p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/5_sampled_images_cfg_part1.6.png"
            alt="5_sampled_images_cfg_part1.6.png"
          />
        </div>
      </div>
    </div>

    <h3>Part 1.7: Image-to-image Translation</h3>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/campanile_1.7.1.png" alt="campanile_1.7.1.png" />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <h4 class="image-title">Berkeley Campanile</h4>
        <div class="image-wrapper">
          <img src="media/part_a/campanile_modified.jpg" alt="campanile_modified.jpg" />
        </div>
      </div>
    </div>

    <p>
      I added two noise levels, 25 and 30, which generate better results (closer to the
      corresponding original images) than samller noise levels, as expected.
    </p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/hoover_tower_1.7.1.png" alt="hoover_tower_1.7.1.png" />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <h4 class="image-title">Hoover Tower</h4>
        <div class="image-wrapper">
          <img src="media/part_a/hoover_tower_modified.jpg" alt="hoover_tower_modified.jpg" />
        </div>
      </div>
    </div>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/green_building_1.7.1.png" alt="green_building_1.7.1.png" />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <h4 class="image-title">Green Building</h4>
        <div class="image-wrapper">
          <img src="media/part_a/green_building_modified.jpg" alt="green_building_modified.jpg" />
        </div>
      </div>
    </div>

    <h4>Part 1.7.1: Editing Hand-Drawn and Web Images</h4>

    <p>
      For the hand drawn images, I used the starter code in the Google Colab notebook to draw and
      process them. Note that the original Hoover Tower and Green Building images are blurry because
      the code resizes them to 64x64.
    </p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/chair_1.7.1.png" alt="chair_1.7.1.png" />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <h4 class="image-title">Chair</h4>
        <div class="image-wrapper">
          <img src="media/part_a/chair_modified.png" alt="chair_modified.png" />
        </div>
      </div>
    </div>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/lamp_1.7.1.png" alt="lamp_1.7.1.png" />
        </div>
      </div>
    </div>
    <div class="image-container-1-wide">
      <div class="image-item">
        <h4 class="image-title">Lamp</h4>
        <div class="image-wrapper">
          <img src="media/part_a/lamp_modified.png" alt="lamp_modified.png" />
        </div>
      </div>
    </div>

    <h4>Part 1.7.2: Inpainting</h4>

    <p></p>

    <div class="image-container-4">
      <div class="image-item">
        <div class="image-wrapper">
          <h4 class="image-title">Original</h4>
          <img
            src="media/part_a/campanile_inpainting_original.jpg"
            alt="campanile_inpainting_original.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <h4 class="image-title">Mask</h4>
          <img
            src="media/part_a/campanile_inpainting_mask.jpg"
            alt="campanile_inpainting_mask.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <h4 class="image-title">Hole to Fill</h4>
        <div class="image-wrapper">
          <img
            src="media/part_a/campanile_inpainting_to_replace.jpg"
            alt="campanile_inpainting_to_replace.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/campanile_inpainting_inpainted.png"
            alt="campanile_inpainting_inpainted.png"
          />
        </div>
      </div>
    </div>

    <p>
      For the hoover tower and green building images, I used all the same variables for inpainting.
    </p>

    <div class="image-container-4">
      <div class="image-item">
        <div class="image-wrapper">
          <h4 class="image-title">Original</h4>
          <img
            src="media/part_a/hoover_tower_inpainting_original.jpg"
            alt="hoover_tower_inpainting_original.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <h4 class="image-title">Mask</h4>
          <img
            src="media/part_a/hoover_tower_inpainting_mask.jpg"
            alt="hoover_tower_inpainting_mask.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <h4 class="image-title">Hole to Fill</h4>
        <div class="image-wrapper">
          <img
            src="media/part_a/hoover_tower_inpainting_to_replace.jpg"
            alt="hoover_tower_inpainting_to_replace.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/hoover_tower_inpainting_inpainted.png"
            alt="hoover_tower_inpainting_inpainted.png"
          />
        </div>
      </div>
    </div>

    <div class="image-container-4">
      <div class="image-item">
        <div class="image-wrapper">
          <h4 class="image-title">Original</h4>
          <img
            src="media/part_a/green_building_inpainting_original.jpg"
            alt="green_building_inpainting_original.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <h4 class="image-title">Mask</h4>
          <img
            src="media/part_a/green_building_inpainting_mask.jpg"
            alt="green_building_inpainting_mask.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <h4 class="image-title">Hole to Fill</h4>
        <div class="image-wrapper">
          <img
            src="media/part_a/green_building_inpainting_to_replace.jpg"
            alt="green_building_inpainting_to_replace.jpg"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/green_building_inpainting_inpainted.png"
            alt="green_building_inpainting_inpainted.png"
          />
        </div>
      </div>
    </div>

    <p>
      Since the green building is not exactly frontward facing, the mask was slightly off centered
      but the result still looks acceptable.
    </p>

    <h4>Part 1.7.3: Text-Conditional Image-to-image Translation</h4>

    <p></p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/campanile_1.7.3.png" alt="campanile_1.7.3.png" />
        </div>
      </div>
    </div>

    <p>
      Using prompt "a photo of a man", we get the result below. We can see that the image from noise
      level 20 gives us a man with a different face.
    </p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/daniel_craig_1.7.3.png" alt="daniel_craig_1.7.3.png" />
        </div>
      </div>
    </div>

    <p>
      Using prompt "a photo of a dog", we get the result below. The image from noise level 20 has
      some traces of a dog in the cat's face but retains most of the qualities that make up the cat
      image.
    </p>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/cat_1.7.3.png" alt="cat_1.7.3.png" />
        </div>
      </div>
    </div>

    <h3>Part 1.8: Visual Anagrams</h3>

    <p>The prompts for the pairs of images are as follows:</p>
    <ol>
      <li>"an oil painting of an old man" and "an oil painting of people around a campfire"</li>
      <li>"a photo of a hipster barista" and "a man wearing a hat"</li>
      <li>"a rocket ship" and "a photo of a dog"</li>
    </ol>

    <p>All images are recognizable both rightside up and upside down.</p>

    <div class="image-container-2">
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/visual_anagram_rightside_up1.png"
            alt="visual_anagram_rightside_up1.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/visual_anagram_upside_down1.png"
            alt="visual_anagram_upside_down1.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/visual_anagram_rightside_up2.png"
            alt="visual_anagram_rightside_up2.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/visual_anagram_upside_down2.png"
            alt="visual_anagram_upside_down2.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/visual_anagram_rightside_up3.png"
            alt="visual_anagram_rightside_up3.png"
          />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img
            src="media/part_a/visual_anagram_upside_down3.png"
            alt="visual_anagram_upside_down3.png"
          />
        </div>
      </div>
    </div>

    <h3>Part 1.9: Hybrid Images</h3>

    <p>The prompts for the pairs of images are as follows:</p>
    <ol>
      <li>"a lithograph of a skull" and "a lithograph of waterfalls"</li>
      <li>"a rocket ship" and "a pencil"</li>
      <li>"a man wearing a hat" and "a lithograph of a skull"</li>
    </ol>

    <div class="image-container-1-wide">
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/hybrid_image1.png" alt="hybrid_image1.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/hybrid_image2.png" alt="hybrid_image2.png" />
        </div>
      </div>
      <div class="image-item">
        <div class="image-wrapper">
          <img src="media/part_a/hybrid_image3.png" alt="hybrid_image3.png" />
        </div>
      </div>
    </div>

    <h2>Part B: Diffusion Models from Scratch!</h2>

    <h3>Part 1: Training a Single-Step Denoising UNet</h3>

    <h3>Part 2: Training a Diffusion Model</h3>

    <h4>2.1-2.3: Adding Time Conditioning to UNet + Training + Sampling</h4>

    <h4>2.4-2.5: Adding Class-Conditioning to UNet + Training + Sampling</h4>

    <h3>What I learned</h3>

    <p></p>
  </body>
</html>
